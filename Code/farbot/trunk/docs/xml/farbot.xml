<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
"http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd">
<book xmlns:xi="http://www.w3.org/2001/XInclude">
  <bookinfo>
    <title>farbot: FreeBSD Automated Release 'Bot</title>

    <legalnotice>
      <para>The content of this guide is the original work of Three Rings
      Design, Inc. All rights reserved.</para>

      <para>The XML and CSS used to generate this guide is based on the work
      of Will Barton and Michael Maibaum, as contributed to the DarwinPorts
      Project under the 3 clause BSD license. Their copyright remains.</para>
    </legalnotice>

    <copyright>
      <year>2006</year>

      <holder>Three Rings Design, Inc.</holder>
    </copyright>

    <copyright>
      <year>2002</year>

      <year>2003</year>

      <year>2004</year>

      <holder>The OpenDarwin Project</holder>
    </copyright>
  </bookinfo>

  <preface>
    <title>About farbot</title>

    <para>farbot was written by Landon Fuller
    <email>landonf@threerings.net</email> for the purpose of automating the
    process of building FreeBSD Jumpstart [netboot] install releases. It
    handles the building of the releases, builds any packages you wish to
    install, configures the bootloader, and constructs the NFS exported
    directory structure needed for a netinstall, all from a simple
    configuration file. We encourage you to submit any patch you think would
    be useful.</para>
  </preface>

  <chapter>
    <title>Installing and Using farbot</title>

    <sect1>
      <title>Installation</title>

      <sect2>
        <title>Prerequisites</title>

        <para>Splat depends on the following components:</para>

        <itemizedlist>
          <listitem>
            <ulink url="http://www.python.org">Python 2.4</ulink>
          </listitem>

          <listitem>
            <ulink url="http://twistedmatrix.com">Twisted Networking
            Framework</ulink>
          </listitem>

          <listitem>
            <ulink
            url="http://www.zope.org/Members/fdrake/zconfig/">Zconfig</ulink>
          </listitem>
        </itemizedlist>
      </sect2>

      <sect2>
        <title>Installing with the Python Distutils</title>

        <para>Splat uses the standard Python distutils. To install, simply run
        <filename>setup.py</filename>: <programlisting>./setup.py install</programlisting></para>

        <para>The farbot library will be installed in the Python site-packages
        directory. The <filename>farbot</filename> command line tool will be
        installed in the Python-specified bin directory. An example
        configuration file, <filename>farbot.conf</filename>, is supplied with
        the source distribution.</para>

        <note>
          <para>The farbot command line tools will be installed in the bin
          directory as specific by Python. On certain operating systems, this
          may not be what you expect. For example, Mac OS X might install
          <filename>farbot</filename> <filename
          class="directory">/Library/Python/2.3/bin</filename>. Feel free to
          move the binaries after the installation is complete.</para>
        </note>
      </sect2>
    </sect1>

    <sect1>
      <title>Configuring farbot</title>

      <sect2>
        <title>Introduction</title>

        <para>The farbot configuration file is composed of five different
        section types: <itemizedlist>
            <listitem>Releases Configuration</listitem>

            <listitem>Partitions Configuration</listitem>

            <listitem>PackageSets Configuration</listitem>

            <listitem>Installations Configuration</listitem>

            <listitem>Logging Configuration</listitem>
          </itemizedlist> The configuration uses an Apache-style syntax:
        <programlisting>
&lt;Installations&gt;
  # An installation for database servers
  &lt;Installation Database&gt;
    # Human-readable Description.
    # Used in the installation-selection boot menu
    Description  Standard Installation
    Release  6.0
    PackageSet Base
    NetworkDevice em0
    &lt;Disk ad0&gt;
      PartitionMap Standard
    &lt;/Disk&gt;
  &lt;/Installation&gt;
&lt;/Installation&gt;
                    </programlisting></para>
      </sect2>

      <sect2>
        <title>Releases Configuration</title>

        <para>The <computeroutput>Releases</computeroutput> section defines at
        least one <computeroutput>Release</computeroutput> within a farbot
        configuration file. </para>

        <sect3>
          <title>Releases Configuration Options</title>

          <variablelist>
            <varlistentry>
              <term>BuildRoot</term>

              <listitem>CHANGE ME</listitem>
            </varlistentry>

            <varlistentry>
              <term>InstallRoot</term>

              <listitem>CHANGE ME</listitem>
            </varlistentry>

            <varlistentry>
              <term>NFSHost</term>

              <listitem>CHANGE ME</listitem>
            </varlistentry>
          </variablelist>

          <sect4>
            <title>Release Configuration Options</title>

            <variablelist>
              <varlistentry>
                <term>CVSRoot</term>

                <listitem>CHANGE ME</listitem>
              </varlistentry>

              <varlistentry>
                <term>CVSTag</term>

                <listitem>CHANGE ME</listitem>
              </varlistentry>

              <varlistentry>
                <term>LocalData</term>

                <listitem>CHANGE ME</listitem>
              </varlistentry>

              <varlistentry>
                <term>InstallCSDs</term>

                <listitem>CHANGE ME</listitem>
              </varlistentry>
            </variablelist>
          </sect4>
        </sect3>
      </sect2>

      <sect2>
        <title>Partitions Configuration</title>

        <para>The <computeroutput>Partitions</computeroutput> section defines
        at least one <computeroutput>PartitionMa</computeroutput> with at
        least one <computeroutput>Partition</computeroutput> within a farbot
        configuration file. </para>

        <sect3>
          <title>PartitionMap Configuration Options</title>

          <sect4>
            <title>Partition Configuration Options</title>

            <variablelist>
              <varlistentry>
                <term>Mount</term>

                <listitem>CHANGE ME</listitem>
              </varlistentry>

              <varlistentry>
                <term>Size</term>

                <listitem>CHANGE ME</listitem>
              </varlistentry>

              <varlistentry>
                <term>Type</term>

                <listitem>CHANGE ME</listitem>
              </varlistentry>

              <varlistentry>
                <term>SoftUpdates</term>

                <listitem>CHANGE ME</listitem>
              </varlistentry>
            </variablelist>
          </sect4>
        </sect3>
      </sect2>

      <sect2>
        <title>PackageSets Configuration</title>

        <para>The <computeroutput>PackageSets</computeroutput> section defines
        at least one <computeroutput>PackageSets</computeroutput> within a
        farbot configuration file. </para>

        <sect3>
          <title>PackageSet Configuration Options</title>

          <sect4>
            <title>Package Configuration Options</title>

            <variablelist>
              <varlistentry>
                <term>Port</term>

                <listitem>CHANGE ME</listitem>
              </varlistentry>

              <varlistentry>
                <term>Package</term>

                <listitem>CHANGE ME</listitem>
              </varlistentry>

              <varlistentry>
                <term>BuildOptions</term>

                <listitem>CHANGE ME</listitem>
              </varlistentry>
            </variablelist>
          </sect4>
        </sect3>
      </sect2>

      <sect2>
        <title>Installations Configuration</title>

        <para>The <computeroutput>Installations</computeroutput> section
        defines at least one <computeroutput>Installation</computeroutput>
        within a farbot configuration file. </para>

        <sect3>
          <title>Installation Configuration Options</title>

          <variablelist>
            <varlistentry>
              <term>Description</term>

              <listitem>CHANGE ME</listitem>
            </varlistentry>

            <varlistentry>
              <term>Release</term>

              <listitem>CHANGE ME</listitem>
            </varlistentry>

            <varlistentry>
              <term>PackageSet</term>

              <listitem>CHANGE ME</listitem>
            </varlistentry>

            <varlistentry>
              <term>NetworkDevice</term>

              <listitem>CHANGE ME</listitem>
            </varlistentry>
          </variablelist>

          <sect4>
            <title>Disk Section Options</title>

            <variablelist>
              <varlistentry>
                <term>PartitionMap</term>

                <listitem>CHANGE ME</listitem>
              </varlistentry>
            </variablelist>
          </sect4>

          <sect4>
            <title>PostInstall Section Options</title>

            <variablelist>
              <varlistentry>
                <term>Command</term>

                <listitem>CHANGE ME</listitem>
              </varlistentry>
            </variablelist>
          </sect4>
        </sect3>
      </sect2>

      <sect2>
        <title>Logging Configuration</title>

        <para>The <computeroutput>Logging</computeroutput> section configures
        logging for the Splat daemon. It is composed of any number of
        <computeroutput>syslog</computeroutput> or
        <computeroutput>logfile</computeroutput> subsections.</para>

        <sect3>
          <title>Syslog Configuration Options</title>

          <variablelist>
            <varlistentry>
              <term>Level</term>

              <listitem>Log Verbosity. One of: debug, info, warning, error,
              critical</listitem>
            </varlistentry>

            <varlistentry>
              <term>Facility</term>

              <listitem>Syslog Facility.</listitem>
            </varlistentry>

            <varlistentry>
              <term>Address</term>

              <listitem>Address of syslog server, or pathname to syslog
              socket. This varies between hosts. FreeBSD's syslog socket is
              located at <filename>/var/run/log</filename>.</listitem>
            </varlistentry>
          </variablelist>
        </sect3>

        <sect3>
          <title>Logfile Configuration Options</title>

          <variablelist>
            <varlistentry>
              <term>Level</term>

              <listitem>Log Verbosity. One of: debug, info, warning, error,
              critical</listitem>
            </varlistentry>

            <varlistentry>
              <term>Path</term>

              <listitem>Path to log file, or reference to Python file object
              such as STDOUT.</listitem>
            </varlistentry>
          </variablelist>
        </sect3>
      </sect2>

      <sect2>
        <title>Example Configuration File</title>

        <para>An example configuration follows. The same configuration file is
        included with the distribution as
        <filename>splat.conf</filename>.</para>

        <programlisting>#
# Releases
#
&lt;Releases&gt;
        # Release Build Working Directory
        BuildRoot       /export/freebsd/build

        # Install/NFS Directory
        # Clients will load installation data from this directory
        InstallRoot     /export/freebsd/netinstall

        # NFS/TFTP Server Host/IP
        # The host exporting the installation data.
        # Should probably be the local machine
        NFSHost         jumpstart.example.org

        &lt;Release 6.0&gt;
                # FreeBSD CVS Repository Mirror
                CVSRoot         /home/ncvs
                # Release Tag
                CVSTag          RELENG_6_0

                # LocalData will be copied into the release
                # distribution. These files will be available at
                # install time via the NFS mount, in the path /dist/local
                LocalData       /export/freebsd/postinst

                # Enable creation of ISO install images
                # Requires cdrtools
                InstallCDs      True
        &lt;/Release&gt;

        &lt;Release 6-STABLE&gt;
                # FreeBSD CVS Repository Mirror
                CVSRoot /home/ncvs
                # Release Tag
                CVSTag  RELENG_6
        &lt;/Release&gt;
&lt;/Releases&gt;

#
# Partition Maps
#
&lt;Partitions&gt;
        &lt;PartitionMap Standard&gt;
                &lt;Partition 1&gt;
                        Mount           /
                        Size            512MB
                        Type            ufs
                        SoftUpdates     no
                &lt;/Partition&gt;

                &lt;Partition 2&gt;
                        Size            4GB
                        Type            swap
                &lt;/Partition&gt;

                &lt;Partition 3&gt;
                        Mount           /var
                        Size            10GB
                        Type            ufs
                &lt;/Partition&gt;

                &lt;Partition 4&gt;
                        Mount           /tmp
                        Size            1GB
                        Type            ufs
                &lt;/Partition&gt;

                &lt;Partition 5&gt;
                        # All remaining space
                        Mount           /usr
                        Size            0GB
                        Type            ufs
                &lt;/Partition&gt;
        &lt;/PartitionMap&gt;
&lt;/Partitions&gt;

#
# Package Sets
#
&lt;PackageSets&gt;
        &lt;PackageSet Base&gt;
                &lt;Package&gt;
                        Port            security/sudo
                &lt;/Package&gt;
        &lt;/PackageSet&gt;
        &lt;PackageSet Database&gt;
                &lt;Package&gt;
                        Port            databases/mysql50-server
                        # If your build options modify the name
                        # of the resulting package, use the Package
                        # option to define the correct name.
                        #Package                mysql50-server
                        &lt;BuildOptions&gt;
                                WITH_COLLATION  latin1_general_ci
                        &lt;/BuildOptions&gt;
                &lt;/Package&gt;
        &lt;/PackageSet&gt;
&lt;/PackageSets&gt;


#
# Installation Types
#
&lt;Installations&gt;
        &lt;Installation Standard&gt;
                # Human-readable Description.
                # Used in the installation-selection boot menu
                Description     Standard Installation
                Release         6.0
                PackageSet      Base
                PackageSet      Database
                NetworkDevice   em0
                &lt;Disk ad0&gt;
                        PartitionMap    Standard
                &lt;/Disk&gt;
                &lt;PostInstall&gt;
                        Command /dist/local/postinst/local.sh database
                        Command /dist/local/postinst/cleanup.sh everything
                &lt;/PostInstall&gt;
        &lt;/Installation&gt;
&lt;/Installations&gt;

&lt;Logging&gt;
        # Logging configuration
        &lt;syslog&gt;
                Level info
                Facility daemon
                Address /var/run/log
        &lt;/syslog&gt;
#       &lt;logfile&gt;
                # Log debug messages to stdout
#               Level debug
#               Path STDOUT
#       &lt;/logfile&gt;
&lt;/Logging&gt;
                </programlisting>
      </sect2>
    </sect1>

    <sect1>
      <title>Running farbot</title>

      <para><filename>farbot</filename> can be run with these arguments
      XXX.</para>
    </sect1>
  </chapter>

  <chapter>
    <title>Not sure we need this. Maybe post install steps?</title>

    <sect1>
      <title>Introduction</title>

      <para>What else do we need to cover?</para>
    </sect1>
  </chapter>
</book>